import { useEffect, useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip } from 'recharts';

const dataTemplate = Array.from({ length: 30 }, (_, i) => ({
  second: i,
  redis: 0,
  elastic: 0,
}));

export default function ScalingShowdown() {
  const [data, setData] = useState(dataTemplate);
  const [running, setRunning] = useState(false);

  useEffect(() => {
    if (!running) return;
    let second = 0;
    const interval = setInterval(() => {
      second++;
      if (second > 29) return clearInterval(interval);

      setData((prev) => {
        const updated = [...prev];
        updated[second] = {
          second,
          // Redis curve: fast but non-linear (starts fast, slows a bit, then finishes fast)
          redis: Math.min(100, Math.round(100 * (1 - Math.exp(-0.15 * second)))),
          // Elastic: linear ramp then plateau
          elastic: second < 10 ? second * 2 : second < 20 ? 20 : 25,
        };
        return updated;
      });
    }, 200);
    return () => clearInterval(interval);
  }, [running]);

  return (
    <div className="p-4 flex flex-col items-center gap-6">
      <h1 className="text-2xl font-bold">Scaling Showdown: Redis vs ElastiCache</h1>
      <Card className="w-full max-w-4xl">
        <CardContent>
          <LineChart width={700} height={300} data={data}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="second" label={{ value: 'Seconds', position: 'insideBottom', offset: -5 }} />
            <YAxis label={{ value: 'Throughput (QPS)', angle: -90, position: 'insideLeft' }} />
            <Tooltip />
            <Line type="monotone" dataKey="redis" stroke="#D82C20" strokeWidth={3} name="Redis Cloud" />
            <Line type="monotone" dataKey="elastic" stroke="#B9C3CD" strokeWidth={3} name="ElastiCache" />
          </LineChart>
        </CardContent>
      </Card>
      <Button onClick={() => { setData(dataTemplate); setRunning(true); }}>Start Load Test</Button>
    </div>
  );
}
